<Window x:Class="AI_Board.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        Title="AI Board" Height="768" Width="1024"
        WindowStyle="None" AllowsTransparency="True" Background="Black"
        WindowStartupLocation="CenterScreen"
        Closing="Window_Closing" Loaded="Window_Loaded"
        MouseLeftButtonDown="Window_MouseLeftButtonDown"
        MouseMove="Window_MouseMove"  
        MouseLeftButtonUp="Window_MouseLeftButtonUp"
        StateChanged="Window_StateChanged"
        SizeChanged="Window_SizeChanged"
        ShowInTaskbar="False">
    <!-- 新增状态监听 -->
    <!--  WindowChrome 让无边框窗口支持边缘拖拽改变大小 -->
    <WindowChrome.WindowChrome>
        <WindowChrome CaptionHeight="0" ResizeBorderThickness="5" GlassFrameThickness="0" CornerRadius="0"/>
    </WindowChrome.WindowChrome>
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <!-- 右侧工具栏宽度缩减为 60 -->
            <ColumnDefinition Width="60"/>
        </Grid.ColumnDefinitions>

        <!-- 左侧：成品视频流 -->
        <Image x:Name="ImgMain" Grid.Column="0" Stretch="Uniform" Margin="0,0,10,0"/>

        <!-- 相机选择弹出框 (Flyout) -->
        <Popup x:Name="PopupCamera" Placement="Left" PlacementTarget="{Binding ElementName=BtnCam}" AllowsTransparency="True" StaysOpen="False">
            <Border Background="#252525" CornerRadius="8" Padding="15" Margin="0,0,10,0" Effect="{StaticResource MaterialDesignElevationShadow6}">
                <StackPanel>
                    <TextBlock Text="选择摄像头" Foreground="Gray" Margin="0,0,0,10"/>
                    <ComboBox x:Name="CmbCameras" Width="220" DisplayMemberPath="Name" SelectedValuePath="Index" 
                              Style="{StaticResource MaterialDesignOutlinedComboBox}" Foreground="White" SelectionChanged="CmbCameras_SelectionChanged"/>
                    <Button Content="刷新列表" Style="{StaticResource MaterialDesignFlatButton}" Margin="0,10,0,0" Click="BtnRefreshCam_Click"/>
                </StackPanel>
            </Border>
        </Popup>
        <!-- 分享菜单弹出框 -->
        <Popup x:Name="PopupShare" Placement="Left" PlacementTarget="{Binding ElementName=BtnShare}" AllowsTransparency="True" StaysOpen="False" Opened="PopupShare_Opened">
            <Border Background="#252525" CornerRadius="8" Padding="15" Margin="0,0,10,0" Effect="{StaticResource MaterialDesignElevationShadow6}">
                <StackPanel Width="220">
                    <TextBlock Text="快捷分享" Foreground="Gray" Margin="0,0,0,10" FontSize="12"/>

                    <!-- 1. 上传到云端 -->
                    <Button Style="{StaticResource MaterialDesignFlatButton}" HorizontalAlignment="Stretch" HorizontalContentAlignment="Left" Click="BtnManualUpload_Click" Height="40">
                        <StackPanel Orientation="Horizontal">
                            <materialDesign:PackIcon Kind="CloudUpload" VerticalAlignment="Center" Margin="0,0,10,0" Foreground="#4A90E2"/>
                            <TextBlock Text="上传到云服务" VerticalAlignment="Center" Foreground="White"/>
                        </StackPanel>
                    </Button>

                    <Separator Background="#444" Margin="0,10"/>

                    <!-- 2. U盘拷贝 -->
                    <TextBlock Text="通过 U 盘拷贝" Foreground="Gray" Margin="0,0,0,5" FontSize="12"/>

                    <!-- U盘列表 -->
                    <ComboBox x:Name="CmbUsbDrives" Style="{StaticResource MaterialDesignOutlinedComboBox}" 
                              Foreground="White" Margin="0,0,0,10"
                              DisplayMemberPath="DisplayName" SelectedValuePath="RootPath"
                              materialDesign:HintAssist.Hint="请选择 U 盘..."/>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <Button Grid.Column="0" Content="保存到 U 盘" Style="{StaticResource MaterialDesignFlatButton}" 
                                Background="#333" Foreground="White" Click="BtnSaveToUsb_Click"/>
                        <Button Grid.Column="1" Style="{StaticResource MaterialDesignIconForegroundButton}" 
                                ToolTip="刷新列表" Width="30" Height="30" Click="BtnRefreshUsb_Click" Margin="5,0,0,0">
                            <materialDesign:PackIcon Kind="Refresh" Foreground="Gray"/>
                        </Button>
                    </Grid>

                </StackPanel>
            </Border>
        </Popup>
        <!-- 右侧工具栏 -->
        <Border Grid.Column="1" Background="#1c1c1c" BorderThickness="1,0,0,0" BorderBrush="#333">
            <Grid Margin="0,20,0,20">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- 标题与状态 -->
                <StackPanel Grid.Row="0" HorizontalAlignment="Center">
                    <!-- 缩小竖排文字占用的宽度 -->
                    <TextBlock Text="AI小黑板" Foreground="White" FontSize="18" Margin="0,0,0,20"
                               FontWeight="Bold" TextWrapping="Wrap" Width="20" TextAlignment="Center"/>

                    <!-- 状态胶囊调窄以适应 60px 边栏 -->
                    <Border x:Name="StatusBorder" Background="#4A7545" CornerRadius="12" Padding="2,12" Width="30" HorizontalAlignment="Center">
                        <TextBlock x:Name="TxtStatusVertical" Text="正常运行" Foreground="White" TextWrapping="Wrap" TextAlignment="Center" Width="15" FontSize="12"/>
                    </Border>
                </StackPanel>

                <!-- 性能监控面板 -->
                <StackPanel Grid.Row="1" VerticalAlignment="Center" HorizontalAlignment="Center">
                    <StackPanel Margin="0,10">
                        <TextBlock x:Name="TxtGpuVal" Text="0%" Foreground="#90EE90" FontSize="16" HorizontalAlignment="Center" FontWeight="Bold"/>
                        <TextBlock Text="GPU" Foreground="Gray" FontSize="10" HorizontalAlignment="Center" Margin="0,2,0,0"/>
                    </StackPanel>
                    <StackPanel Margin="0,10">
                        <TextBlock x:Name="TxtCpuVal" Text="0%" Foreground="#90EE90" FontSize="16" HorizontalAlignment="Center" FontWeight="Bold"/>
                        <TextBlock Text="CPU" Foreground="Gray" FontSize="10" HorizontalAlignment="Center" Margin="0,2,0,0"/>
                    </StackPanel>
                    <StackPanel Margin="0,10">
                        <TextBlock x:Name="TxtFpsVal" Text="0.0" Foreground="White" FontSize="16" HorizontalAlignment="Center" FontWeight="Bold"/>
                        <TextBlock Text="FPS" Foreground="Gray" FontSize="10" HorizontalAlignment="Center" Margin="0,2,0,0"/>
                    </StackPanel>
                </StackPanel>

                <!-- 底部三个按钮，缩小长宽和边距 -->
                <StackPanel Grid.Row="2" HorizontalAlignment="Center">
                    <Button x:Name="BtnShare" Style="{StaticResource MaterialDesignIconForegroundButton}" Height="50" Width="50" Click="BtnShare_Click" Padding="0" Margin="0,0,0,5">
                        <StackPanel>
                            <materialDesign:PackIcon Kind="ShareVariant" Width="24" Height="24" Foreground="#DDD" HorizontalAlignment="Center"/>
                            <TextBlock Text="分享" FontSize="10" Foreground="#DDD" HorizontalAlignment="Center" Margin="0,2,0,0"/>
                        </StackPanel>
                    </Button>
                    <Button x:Name="BtnCam" Style="{StaticResource MaterialDesignIconForegroundButton}" Height="50" Width="50" Click="BtnCam_Click" Padding="0">
                        <StackPanel>
                            <materialDesign:PackIcon Kind="CameraOutline" Width="24" Height="24" Foreground="#DDD" HorizontalAlignment="Center"/>
                            <TextBlock Text="相机" FontSize="10" Foreground="#DDD" HorizontalAlignment="Center" Margin="0,2,0,0"/>
                        </StackPanel>
                    </Button>
                    <Button x:Name="BtnSettings" Style="{StaticResource MaterialDesignIconForegroundButton}" Height="50" Width="50" Click="BtnSettings_Click" Padding="0">
                        <StackPanel>
                            <materialDesign:PackIcon Kind="CogOutline" Width="24" Height="24" Foreground="#DDD" HorizontalAlignment="Center"/>
                            <TextBlock Text="设置" FontSize="10" Foreground="#DDD" HorizontalAlignment="Center" Margin="0,2,0,0"/>
                        </StackPanel>
                    </Button>
                    <Button Style="{StaticResource MaterialDesignIconForegroundButton}" Height="50" Width="50" Click="BtnMinimize_Click"                         PreviewMouseRightButtonDown="BtnMinimize_PreviewMouseRightButtonDown" Padding="0">
                        <StackPanel>
                            <materialDesign:PackIcon Kind="ChevronDown" Width="28" Height="28" Foreground="#DDD" HorizontalAlignment="Center"/>
                            <TextBlock Text="最小化" FontSize="10" Foreground="#DDD" HorizontalAlignment="Center" Margin="0,-3,0,0"/>
                        </StackPanel>
                    </Button>
                </StackPanel>
                
            </Grid>
        </Border>
        <Border x:Name="ToastContainer" VerticalAlignment="Bottom" HorizontalAlignment="Center" 
Margin="0,0,0,80" CornerRadius="20" Opacity="0" IsHitTestVisible="False"
Effect="{StaticResource MaterialDesignElevationShadow6}">
            <Border.Style>
                <Style TargetType="Border">
                    <Setter Property="Background" Value="#333333"/>
                    <!-- 默认背景 -->
                </Style>
            </Border.Style>

            <StackPanel Orientation="Horizontal" Margin="20,10">
                <!-- 图标 -->
                <materialDesign:PackIcon x:Name="ToastIcon" Kind="Information" 
                         VerticalAlignment="Center" Foreground="White" Margin="0,0,10,0"/>
                <!-- 文本 -->
                <TextBlock x:Name="ToastText" Text="操作消息" Foreground="White" 
           VerticalAlignment="Center" FontSize="14" FontWeight="Medium"/>
            </StackPanel>
        </Border>
    </Grid>
</Window>